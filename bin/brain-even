#!/usr/bin/env php

<?php

require_once __DIR__ . '/brain-games';

use function BrainGames\Cli\printString;
use function BrainGames\Cli\getStringLine;
use function BrainGames\Cli\printStringVar;


const lineGameTask = "Answer \"yes\" if the number is even, otherwise answer \"no\".";
const lineAnswer = 'Your answer';

const templateQuestion = "Question: %s";
const templateUserVictory = "Congratulations, %s!";
const templateUserLosing = "Let's try again, %s!";

const gameAnswers = [true => 'yes', false => 'no'];
const gameStatuses = [true => 'Correct!', false => "'%s' is wrong answer ;(. Correct answer was '%s'."];

const gameTaskParamMin = 1;
const gameTaskParamMax = 100;

$gameIteration = 3;

function gameTask($gameTaskParamMin = gameTaskParamMin, $gameTaskParamMax = gameTaskParamMax)
{
    return rand($gameTaskParamMin, $gameTaskParamMax);
}

function gameSolution($var)
{
    $result = $var % 2 === 0;

    return $result;
}

function printQuestion($lineQuestionVar)
{
    printStringVar(templateQuestion, $lineQuestionVar);
}

function getUserAnswer()
{
    $userAnswer = getStringLine(lineAnswer);
    $userAnswerBool = gameAnswers[true] === $userAnswer ? true : false;

    return ['string' => $userAnswer, 'bool' => $userAnswerBool];
}

function game() {
    $gameValue = gameTask();
    $gameAnswer = gameSolution($gameValue);

    $lineQuestionVar = $gameValue;
    printQuestion($lineQuestionVar);

    $userAnswer = getUserAnswer();

    if ($gameAnswer !== $userAnswer['bool']) {
        if ($userAnswer['bool']) {
            printStringVar(gameStatuses[false], gameAnswers[true], $userAnswer['string']);
        } else {
            printStringVar(gameStatuses[false], $userAnswer['string'], gameAnswers[true]);
        }
        return false;
    }

    printString(gameStatuses[true]);
    return true;
}

printString(lineGameTask);

$gameResult = game();
while ($gameResult && ($gameIteration - 1 > 0))
{
    $gameResult = game();
    $gameIteration -= 1;
}

$gameResult 
    ? printStringVar(templateUserVictory, $userName)
    : printStringVar(templateUserLosing, $userName);
